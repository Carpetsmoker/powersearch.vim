Various search-related stuff.

Works well enough, but needs a bit more work...
